<!doctype HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
<meta http-equiv="Content-Language" content="ru">
<meta http-equiv="Content-Type" content="text/html; charset=windows-1251">
<link rel="stylesheet" href="css.css" type="text/css">
<TITLE>Приложения-Образцы Videoapp и Oldvideo.</TITLE></HEAD>
<BODY>
<h5><a href="contents.htm">Оглавление</a> | <a href="errors.htm">Назад</a>
| <a href="partlc.htm">Вперёд</a>
| <a href="bklast.htm">Индекс</a></h5>
<HR>
<A NAME="1042256"></A><h1>Глава 13<BR><A NAME="1032862"></A>Приложения-Образцы Videoapp и Oldvideo</h1>
<p><A NAME="1038466"></A>В этой главе описано приложение-образец videoapp, 
иллюстрирующее использование службы LiveWire Database Service. Рассмотрено, как 
сконфигурировать рабочую среду для запуска приложений videoapp и oldvideo.</p>
<p><A NAME="1043047"></A>В главе имеются следующие разделы:</p>
<ul><LI><A NAME="1043477"></A>
<A HREF="#1037277">О Приложениях Videoapp и Oldvideo</A><LI><A NAME="1042296"></A>
<A HREF="#1034694">Конфигурирование Среды</A><LI><A NAME="1042300"></A><A HREF="#1037116">
Запуск Videoapp</A></LI><LI><A NAME="1042304"></A><A HREF="#1037155">Взгляд на Исходные Файлы</A></LI></ul>
<H2><A NAME="About Videoapp and Oldvideo Sample Applications"></A>
<A NAME="1037277"></A>О Приложениях Videoapp и Oldvideo</H2><hr>
<p><A NAME="1043463"></A>Netscape-серверы поставляются с двумя приложениями-образцами для работы с базами 
данных, <CODE>videoapp</CODE> и
<CODE>oldvideo</CODE>, которые иллюстрируют работу LiveWire Database Service. 
Эти приложения весьма похожи; они отслеживают прокат видео в воображаемом 
видео-салоне. Приложение <CODE>videoapp</CODE> демонстрирует использование 
объектов <CODE>DbPool</CODE> и <CODE>Connection</CODE>.
Приложение <CODE>oldvideo</CODE> демонстрирует использование предопределённого 
объекта <CODE>database</CODE>.</p>
<p>
<A NAME="1040700"></A>Есть несколько небольших ограничений на использование этих 
приложений:</p>
<ul><LI><A NAME="1040701"></A>Приложение <CODE>videoapp</CODE> не может 
базироваться на БД Informix. Приложение <CODE>oldvideo</CODE> может 
использоваться с Informix.</LI><LI><A NAME="1040664"></A>Поскольку эти 
приложения могут использоваться с ODBC и SQL Server,
если драйвер на Вашей платформе не поддерживает обновляемые курсоры, приложения работать не будут.
О том, какие драйверы поддерживают обновляемые курсоры, см. раздел <A HREF="dbconfig.htm#1029166">"Поддерживаемые 
Клиенты БД и ODBC-Драйверы&quot;</A></LI>.<LI><A NAME="1040711"></A>
Приложение <CODE>videoapp</CODE> использует курсоры, захватывающие несколько HTML-страниц. 
Если ваш драйвер БД - однопоточный, эти курсоры могут иметь блокировки для БД 
и препятствовать доступу к ним других пользователей.<br>
  О том, какие драйверы являются однопоточными, см. <EM><A HREF="http://home.netscape.com/eng/server/webserver/3.0/es36.htm" TARGET="_blank">Enterprise
Server 3.x Release Notes</A></EM>.</LI></ul>
<H2><A NAME="Configuring Your Environment"></A><A NAME="1034694"></A>
Конфигурирование Среды</H2><hr>
<p><A NAME="1037101"></A>Прежде чем Вы сможете запустить эти приложения, 
необходимо сделать незначительные изменения в исходных файлах и создать базу 
данных для видео. В данном разделе указывается, какие файлы Вы обязаны изменить 
и какие процедуры выполнить, чтобы внести эти изменения и создать БД для каждого 
из поддерживаемых серверов БД. См. конкретную информацию в разделе, посвящённом Вашему серверу БД.</p>
<BLOCKQUOTE>
<p><B>ПРИМЕЧАНИЕ:</B></p>
<p><A NAME="1032767"></A>
Ваш сервер БД обязан быть настроен и запущен перед началом создания видео-БД, и 
Вы обязаны сконфигурировать сервер и клиента БД так, как указано в <A HREF="dbconfig.htm#1055577">
Главе 10, "Конфигурирование Базы Данных&quot;.</p></BLOCKQUOTE>
<p><A NAME="1032834"></A>Кроме того, скрипты создания БД используют утилиты БД, 
поставляемые с Вашими БД. Вы уже должны знать, как пользоваться этими утилитами.</p>
<h4><A NAME="Head2;"></A><A NAME="1034762"></A>Соединение с БД и Рекомпиляция</h4><hr>
<p><A NAME="1032835"></A>Приложение <CODE>videoapp</CODE> находится в директории
<CODE>$NSHOME\js\samples\videoapp</CODE>, где <CODE>$NSHOME</CODE> это 
директория установки Netscape-сервера. Приложение <CODE>oldvideo</CODE> находится в директории
<CODE>$NSHOME\js\samples\oldvideo</CODE>.</p>
<p><A NAME="1034848"></A>Для каждого приложения Вы обязаны изменить строку с информацией о соединении в 
исходном HTML-файле <CODE>start.htm</CODE>,
чтобы настроиться на среду окружения Вашей БД. О параметрах соединения см. раздел
<A HREF="db1.htm#1030030">"Пул Соединений Базы Данных&quot;</A>; дополнительно см. 
также описание метода <CODE>connect</CODE> в книге <I>
<a href="../servref12/index.htm">Серверный JavaScript. Справочник</a></I>.</p>
<p><A NAME="1034903"></A>Для приложения <CODE>videoapp</CODE> измените эту строку:</p>
<PRE><A NAME="1032836"></A>project.sharedConnections.pool = <br>
&nbsp;&nbsp;&nbsp;new DbPool ("&lt;Server Type&gt;", "&lt;Server Identifier&gt;",
"&lt;User&gt;", "&lt;Password&gt;", "&lt;Database&gt;", 2, false)</PRE>
<p><A NAME="1034827"></A>Для приложения <CODE>oldvideo</CODE> измените эту строку:</p>
<PRE><A NAME="1034937"></A>database.connect ("INFORMIX", "yourserver", "informix",&nbsp;"informix", "lw_video")</PRE>
<p><A NAME="1037938"></A>
Сохраните изменения и рекомпилируйте приложение. Для рекомпиляции приложения из 
командной строки запустите его build-файл, расположенный в директории приложения. 
Убедитесь, что переменная окружения <CODE>PATH</CODE> содержит путь к 
компилятору (обычно это <CODE>$NSHOME\bin\https</CODE>).</p>
<p><A NAME="1037939"></A>Рестартуйте приложения в JavaScript Application Manager'е.</p>
<h4><A NAME="Head2;"></A><A NAME="1035038"></A>Создание Базы Данных</h4><hr>
<p><A NAME="1034976"></A>
Имеются два набора скриптов создания БД для <CODE>videoapp</CODE> и <CODE>oldvideo</CODE>, 
находящиеся в соответствующих этим приложениям директориях. Наборы скриптов 
идентичны. Если Вы запустите один набор, оба приложения смогут использовать БД.</p>
<p><A NAME="1034980"></A>При первом запуске скриптов Вы можете получать ошибки, 
касающиеся стирания БД или таблиц, которые ещё не существуют. Это нормально; 
можно спокойно игнорировать эти сообщения.</p>
<H4><A NAME="Head3;"></A><A NAME="1029673"></A>Informix</H4><hr><p>
<A NAME="1029674"></A>Прежде чем использовать нижеуказанные инструкции, Вы 
обязаны сконфигурировать Ваш Informix-клиент, как указано в разделе <A HREF="dbconfig.htm#1030068">"Informix."</A> 
Кроме того, убедитесь, что переменная окружения <CODE>PATH</CODE> содержит путь 
к <CODE>$INFORMIXDIR\bin</CODE> и что Ваш клиент сконфигурирован для использования утилит Informix.</p>
<p><A NAME="1035080"></A>SQL-файлы для создания видео-БД (<CODE>lw_video</CODE>) 
в Informix находятся в двух директориях:</p>
<PRE><A NAME="1035084"></A>$NSHOME\js\samples\videoapp\ifx <br>$NSHOME\js\samples\oldvideo\ifx</PRE>
<BLOCKQUOTE>
<p><B>ПРИМЕЧАНИЕ:</B></p>
<p><A NAME="1035630"></A>
Не забудьте, что пути в этом учебнике, если они относятся и к NT, и к Unix, 
даются в формате NT. В Unix Вы используете <CODE>$NSHOME/js/samples/videoapp/ifx.</CODE></p></BLOCKQUOTE>
<OL><LI><A NAME="1035613"></A>В Unix войдите в систему как пользователь "informix" и запустите скрипт оболочки
<CODE>ifx_load.csh</CODE> для <CODE>videoapp</CODE> и для <CODE>oldvideo</CODE>.</LI><br>
<A NAME="1034146"></A>В NT дважды щёлкните в группе программ Informix Server
иконку Command-Line Utilities, чтобы открыть окно DOS, затем запустите 
следующие команды:<PRE><A NAME="1034148"></A>cd c:\netscape\server\js\samples\videoapp\ifx<br>ifx_load.bat</PRE>
<A NAME="1034139"></A>Вы можете также запустить эти команды из директории <CODE>oldvideo\ifx</CODE>:<LI><A NAME="1035128"></A>
Теперь Вы можете запускать приложение, сделав предварительно изменения, описанные в разделе
<A HREF="#1034762">"Соединение с Базой Данных и Рекомпиляция&quot;</A>.</LI></OL>
<H4><A NAME="Head3;"></A><A NAME="1029688"></A>Oracle</H4><hr><p><A NAME="1040756"></A>
Прежде чем использовать нижеуказанные инструкции, Вы обязаны сконфигурировать 
Ваш Oracle-клиент, как указано в разделе
<A HREF="dbconfig.htm#1057005">"Oracle."</A> Помимо этого, Ваш клиент обязан 
быть сконфигурирован для запуска утилит Oracle. Чтобы запускать SQL Plus, Вам 
может понадобиться установить переменную окружения <CODE>ORACLE_SID</CODE>.</p>
<p><A NAME="1040760"></A>SQL-файлы для создания видео-БД в Oracle, находятся в двух директориях:</p>
<PRE><A NAME="1035151"></A>$NSHOME\js\samples\videoapp\ora<br>$NSHOME\js\samples\oldvideo\ora</PRE><OL>
<LI><A NAME="1033588"></A>
И в Unix, и в NT: стартуйте SQL Plus. Из промпта <CODE>SQL&gt;</CODE> введите 
такую команду:</LI><PRE><A NAME="1029694"></A>Start $NSHOME\js\samples\videoapp\ora\ora_video.sql</PRE><A NAME="1035175"></A>
Вы можете также запустить этот скрипт из директории <CODE>oldvideo</CODE>. Этот SQL-скрипт 
не создаёт новую БД. Он создаёт таблицы Oracle в текущем экземпляре.<LI><A NAME="1034276"></A>
В Unix: запустите скрипт-файл <CODE>ora_load</CODE> для загрузки видео-таблиц с 
данными. В NT: запустите пакетный файл
<CODE>ora_load.bat</CODE> для загрузки видео-таблиц с данными. Вы обязаны 
отредактировать соответствующий файл для подключения к Вашему серверу; 
инструкции об этом содержатся в файле.</LI>
<LI><A NAME="1035206"></A>Теперь можно запускать приложение, сделав изменения, 
описанные в разделе
<A HREF="#1034762">"Соединение с Базой Данных и Рекомпиляция&quot;</A>.</LI></OL>
<H4><A NAME="Head3;"></A><A NAME="1029709"></A>Sybase</H4><hr>
<p><A NAME="1035216"></A>
Прежде чем использовать нижеуказанные инструкции, Вы обязаны сконфигурировать 
Ваш Sybase-клиент, как указано в разделе
<A HREF="dbconfig.htm#1037471">"Sybase."</A> Кроме того, в Unix убедитесь, что 
переменная окружения <CODE>PATH</CODE> содержит <CODE>$SYBASE\bin</CODE> и <CODE>DSQUERY</CODE> указывает на ваш сервер.</p>
<p><A NAME="1035211"></A>SQL-файлы для создания видео-БД в Sybase, находятся в двух директориях:</p>
<PRE><A NAME="1036976"></A>$NSHOME\js\samples\videoapp\syb<br>$NSHOME\js\samples\oldvideo\syb</PRE><OL>
<LI><A NAME="1036977"></A>Запустите соответствующий скрипт из командной строки. 
В Unix это:</LI><PRE><A NAME="1036978"></A>syb_video.csh <I><CODE>userid password</CODE></I></PRE><A NAME="1029716"></A>
Например:<PRE><A NAME="1029717"></A>$NSHOME\js\samples\videoapp\syb\syb_load.csh sa</PRE>
<A NAME="1034014"></A>В NT это скрипт:<PRE><A NAME="1034291"></A>syb_load<I><CODE> userid
password</CODE></I></PRE><A NAME="1034306"></A>
Например:<PRE><A NAME="1034307"></A>c:\netscape\server\js\samples\videoapp\syb\syb_load sa</PRE>
<A NAME="1035246"></A>Можно также запустить скрипт из директории <CODE>oldvideo</CODE>.<br><LI><A NAME="1035242"></A><A NAME="1035206"></A>
Теперь можно запускать приложение, сделав изменения, описанные в разделе
<A HREF="#1034762">"Соединение с Базой Данных и Рекомпиляция&quot;</A>.</LI></OL>
<BLOCKQUOTE>
<p><B>ПРИМЕЧАНИЕ:</B></p>
<p><A NAME="1035306"></A>
Если у Вас на машине установлены и Sybase, и MS SQL Server или DB2, 
потенциально может возникнуть конфликт имён. Эти производители поставляют утилиты с 
одинаковыми названиями (<CODE>bcp</CODE> и <CODE>isql</CODE>). При запуске 
этих скриптов убедитесь, что переменная окружения настроена для запуска корректной утилиты.</p></BLOCKQUOTE>
<H4><A NAME="Head3;"></A><A NAME="1034376"></A>Microsoft SQL Server (только для NT)</H4><hr>
<p><A NAME="1040789"></A><A NAME="1035216"></A>
Прежде чем использовать нижеуказанные инструкции, Вы обязаны сконфигурировать 
Ваш Sybase-клиент, как указано в разделе
<A HREF="dbconfig.htm#1030156">"ODBC."</A> Кроме того, в Unix установите <CODE>DSQUERY</CODE> 
так, чтобы она указывала на Ваш сервер.</p><p><A NAME="1035271"></A>
SQL-файлы для создания видео-БД в MS SQL Server, находятся в двух директориях:</p>
<PRE><A NAME="1035284"></A>$NSHOME\js\samples\videoapp\mss<br>$NSHOME\js\samples\oldvideo\mss</PRE><OL>
<LI><A NAME="1034379"></A>Из командной строки DOS запустите пакетный файл:</LI><PRE><A NAME="1034381"></A>mss_load <I><CODE>userid password</CODE></I></PRE><A NAME="1034382"></A>
Например:<PRE><A NAME="1034383"></A>c:\netscape\server\js\samples\videoapp\mss\mss_load sa</PRE>
<LI><A NAME="1035297"></A>Теперь можно запускать приложение, сделав изменения, 
описанные в разделе
<A HREF="#1034762">"Соединение с Базой Данных и Рекомпиляция&quot;</A>.</LI></OL>
<BLOCKQUOTE>
<p><B>ПРИМЕЧАНИЕ:</B></p>
<p><A NAME="1035302"></A>
Если у Вас на машине установлены и Sybase, и MS SQL Server или DB2, 
потенциально может возникнуть конфликт имён. Эти производители поставляют 
утилиты с одинаковыми названиями (<CODE>bcp</CODE> и <CODE>isql</CODE>). При запуске 
этих скриптов убедитесь, что переменная окружения настроена для запуска корректной утилиты.</p></BLOCKQUOTE>
<H4><A NAME="Head3;"></A><A NAME="1035309"></A>DB2</H4><hr><p><A NAME="1035312"></A>
SQL-файлы для создания видео-БД в DB2, находятся в двух директориях:</p>
<PRE><A NAME="1035313"></A>$NSHOME\js\samples\videoapp\db2<br>$NSHOME\js\samples\oldvideo\db2</PRE><OL>
<LI><A NAME="1035354"></A>(Только в Unix) Ваша переменная окружения <CODE>PATH</CODE> 
обязана содержать директории <CODE>$DB2PATH/bin</CODE>, <CODE>$DB2PATH/misc</CODE> 
и <CODE>$DB2PATH/adm</CODE>.</LI><LI><A NAME="1035850"></A>Прежде чем запустить 
эти скрипты, Вы обязаны уже иметь установленный DB2
Software Developer's Kit (DB2 SDK).</LI><LI><A NAME="1036262"></A>
Также, прежде чем Вы сможете запустить скрипты для создания таблиц, Вы обязаны 
отредактировать их, чтобы изменить некоторые параметры.
В Unix это скрипт <CODE>db2_load.csh</CODE>; в NT это скрипт <CODE>db2_load.bat</CODE>. 
Отредактируйте соответствующий файл <CODE>db2_load</CODE> и измените следующие 
параметры, отражающие Ваше окружение:</LI><ul><LI><A NAME="1036263"></A><CODE>&lt;nodename&gt;</CODE>: 
псевдоним имени узла/node name alias</LI><LI><A NAME="1036264"></A>
<CODE>&lt;hostname&gt;</CODE>: имя хоста узла, где находится целевая БД</LI><LI><A NAME="1035395"></A><CODE>&lt;service-name&gt;</CODE>: 
имя службы или имя экземпляра из файлов службы</LI><LI><A NAME="1035406"></A><CODE>&lt;database-name&gt;</CODE>: 
имя БД</LI><LI><A NAME="1035407"></A><CODE>&lt;user&gt;</CODE>: авторизованный 
пользователь</LI><LI><A NAME="1035408"></A><CODE>&lt;password&gt;</CODE>: пароль пользователя</LI></ul>
<LI><A NAME="1036576"></A>Убедитесь, что Ваши файлы <CODE>/etc/services</CODE> 
имеют вхождения для экземпляра или имени службы, если Вы создаёте БД на удалённом DB2-сервере.</LI><LI><A NAME="1035673"></A>
Запустите соответствующую версию скрипта из окна команд DB2.
Скрипт <CODE>db2_load</CODE> запускает скрипты <CODE>db2_video.sql</CODE> и <CODE>import.sql</CODE>.
Эти вспомогательные скрипты создают видео-таблицы и загружают их данными из 
файлов <CODE>*.del</CODE>.
Они не создают новую БД. Они создают таблицы DB2 в псевдониме локальной БД, 
специфицированном в скрипте <CODE>db2_load</CODE>.</LI></OL>
<BLOCKQUOTE>
<p><B>ПРИМЕЧАНИЕ:</B></p>
<p><A NAME="1040808"></A><A NAME="1035302"></A>
Если у Вас на машине установлены и DB2, и Sybase или MS SQL Server, 
потенциально может возникнуть конфликт имён. Эти производители поставляют 
утилиты с одинаковыми названиями (<CODE>bcp</CODE> и <CODE>isql</CODE>). При запуске 
этих скриптов убедитесь, что переменная окружения настроена для запуска корректной утилиты.</p></BLOCKQUOTE>
<H2><A NAME="Running Videoapp"></A><A NAME="1037116"></A>Запуск Videoapp</H2><hr><p><A NAME="1037118"></A>
В этом разделе говорится о запуске приложения<CODE> videoapp</CODE>. Это 
значительно более сложный пример, нежели образцы, рассмотренные в <A HREF="sampapp.htm#997386">
Главе 4, "Быстрое Начало с Примерами Приложений&quot;</A>. В этой главе дан только его 
обзор. Вы должны просмотреть также некоторые файлы, чтобы получше познакомиться с приложением.</p>
<p><A NAME="1037130"></A>После создания видео-БД и изменения параметров соединения 
с БД Вы можете запустить приложение:</p>
<PRE><A NAME="1037131"></A>http://<I><CODE>server.domain</CODE></I>/videoapp</PRE><p><A NAME="1037132"></A>
После соединения с БД менеджер Application Manager выводит домашнюю страницу <CODE>videoapp</CODE>,<br>
как показано на <A HREF="#1037140">Рисунке 13.1</A>.</p><h5><A NAME="1037140"></A>
Рисунок 13.1 &nbsp;&nbsp;Домашняя страница Videoapp</h5>
<P><IMG SRC="graphics/video.gif" width="611" height="758"></P>
<p><A NAME="1037141"></A>Если соединение с БД невозможно установить, Вы увидите 
сообщение об ошибке. Убедитесь, что введены корректные параметры соединения с БД, как указано в разделе
<A HREF="#1034762">"Соединение с Базой Данных и Рекомпиляция&quot;</A>, приложение 
рекомпилировано и рестартовало.</p>
<p><A NAME="1040847"></A>Первое, что нужно сделать при установлении соединения, 
это создать нового потребителя/customer. Пока Вы этого не сделаете, нет ни 
одного потребителя, который может использовать другие функции приложения.</p>
<p><A NAME="1037145"></A>Вы можете использовать <CODE>videoapp</CODE> как customer или как administrator. 
Как customer Вы можете:</p>
<ul><LI><A NAME="1037146"></A>Арендовать клип</LI><LI><A NAME="1037147"></A>
Показать все клипы/movies, арендованные Вами</LI></ul><p><A NAME="1037148"></A>
Как administrator Вы можете:</p>
<ul><LI><A NAME="1037149"></A>Показать все клипы и тех, кто их арендует</LI><LI><A NAME="1037150"></A>
Вернуть video потребителю</LI><LI><A NAME="1037151"></A>Добавить нового 
потребителя</LI><LI><A NAME="1037152"></A>Удалить потребителя</LI><LI><A NAME="1037153"></A>
Изменить потребителя</LI></ul>
<p><A NAME="1037154"></A>
Запустите приложения и сделайте несколько выборов для выполнения различных действий.</p>
<H2><A NAME="Looking at the Source Files"></A><A NAME="1037155"></A>Взгляд на Исходные Файлы</H2><hr>
<p><A NAME="1037159"></A>Исходные HTML-файлы <CODE>videoapp</CODE>,
перечисленные в следующей таблице, обильно комментируются.</p>
<A NAME="1043038"></A><h5><A NAME="1037166"></A>
Таблица 13.1&nbsp; Первичные исходные файлы приложения <CODE>videoapp</CODE></h5>
<TABLE BORDER="2" CELLPADDING=5>
<TR><TD VALIGN=baseline ALIGN=left><PRE><A NAME="1037170"></A>home.htm</PRE><TD VALIGN=baseline ALIGN=left>
<P><A NAME="1037172"></A>Страница по умолчанию. Имеет ссылки на <CODE>pick.htm</CODE>,
<CODE>status.htm</CODE>, <CODE>rentals.htm</CODE>, <CODE>customer.htm</CODE> и
<CODE>delete.htm</CODE>. Если нет соединения с БД, эта страница перенаправляет клиента на страницу
<CODE>start.htm</CODE>.</P><TR><TD VALIGN=baseline ALIGN=left><PRE><A NAME="1037174"></A>start.htm</PRE>
<TD VALIGN=baseline ALIGN=left><P><A NAME="1037176"></A>
Соединяет приложение с БД, стартует транзакцию и переводит обратно на <CODE>home.htm</CODE>.</P>
<TR><TD VALIGN=baseline ALIGN=left><PRE><A NAME="1038986"></A>abort.htm</PRE>
<TD VALIGN=baseline ALIGN=left><P><A NAME="1038988"></A>
Отменяет одну транзакцию и начинает новую.</P>
<TR><TD VALIGN=baseline ALIGN=left><PRE><A NAME="1039002"></A>save.htm</PRE>
<TD VALIGN=baseline ALIGN=left><P><A NAME="1039004"></A>
Подтверждает/Commits транзакцию и начинает новую.</P>
<TR><TD VALIGN=baseline ALIGN=left><PRE><A NAME="1037178"></A>pick.htm</PRE><TD VALIGN=baseline ALIGN=left>
<P><A NAME="1039057"></A>Позволяет потребителю взять клип напрокат. Содержит 
фрэймы для
<CODE>category.htm</CODE>, <CODE>videos.htm</CODE> и <CODE>pickmenu.htm</CODE>.</P><P><A NAME="1039058"></A>
Файл <CODE>category.htm</CODE> показывает категории видео.</P><P><A NAME="1039059"></A>
Файл <CODE>videos.htm</CODE> показывает все видео в выбранной категории и 
соединён с
<CODE>rent.htm</CODE> для аренды определённых видео.</P><P><A NAME="1039060"></A>
Файл <CODE>pickmenu.htm</CODE> показывает другие страницы.</P>
<TR><TD VALIGN=baseline ALIGN=left><PRE><A NAME="1037182"></A>status.htm</PRE>
<TD VALIGN=baseline ALIGN=left><P><A NAME="1037184"></A>Выводит видео, имеющиеся 
у потребителя в данный момент. Если потребитель не выбрал ID, перенаправляет его 
на страницу <CODE>client.htm</CODE>, на которой можно выбрать customer ID.</P><TR><TD VALIGN=baseline ALIGN=left><PRE><A NAME="1037186"></A>rentals.htm</PRE>
<TD VALIGN=baseline ALIGN=left><P><A NAME="1037188"></A>Выводит список всех 
взятых видео. Когда администратор щёлкает на названии одного их них, выбранная 
позиция отправляется на <CODE>return.htm</CODE>, которая выполняет действия по 
возвращению видео, затем направляет обратно на <CODE>rentals.htm</CODE>.</P>
<TR><TD VALIGN=baseline ALIGN=left><PRE><A NAME="1037190"></A>customer.htm</PRE>
<TD VALIGN=baseline ALIGN=left><P><A NAME="1037192"></A>Администратор может 
ввести здесь нового потребителя.
Отправляет введённые в форму данные на <CODE>add.htm</CODE>, где выполняются 
действия по вводу нового потребителя, затем возвращает на <CODE>customer.htm</CODE>.</P><TR><TD VALIGN=baseline ALIGN=left><PRE><A NAME="1037194"></A>delete.htm</PRE>
<TD VALIGN=baseline ALIGN=left><P><A NAME="1037196"></A>Здесь администратор 
может удалить потребителя.
Выводит список потребителей со ссылками на <CODE>remove.htm</CODE>, где 
удаляется специфицированный ряд из таблицы потребителей, затем возвращает на <CODE>delete.htm</CODE>.</P>
<TR><TD VALIGN=baseline ALIGN=left><PRE><A NAME="1037198"></A>modify.htm</PRE><TD VALIGN=baseline ALIGN=left>
<P><A NAME="1038884"></A>Администратор может изменить здесь данные потребителя. 
Выводит список из первых 5 потребителей со ссылками на страницы <CODE>modify1.htm</CODE> 
и <CODE>modify2.htm</CODE>. Эти страницы обновляют специфицированный ряд в 
таблице потребителей и возвращают обратно на <CODE>modify.htm</CODE>.
Файл <CODE>modify3.htm </CODE>выводит следующих потребителей, 5 за один раз.</P></TABLE>
<h4><A NAME="Head2;"></A><A NAME="1039450"></A>Архитектура Приложения</h4><hr>
<p><A NAME="1039451"></A>
Этот раздел ориентирует Вас на реализацию некоторой функциональности в <CODE>videoapp</CODE>.
Он описывает, как приложение работает с БД и детали процедуры аренды видео.
Другие задачи похожи.</p><H4><A NAME="Head3;"></A><A NAME="1039452"></A>Соединение и Процесс Работы</H4>
<hr><p><A NAME="1039446"></A>Когда пользователь инициирует сессию с приложением <CODE>videoapp</CODE>, 
входя на начальную страницу (<CODE>home.htm</CODE>), <CODE>videoapp</CODE> 
проверяет, имеется ли уже соединение с БД. Если это так, <CODE>videoapp</CODE> 
предполагает, что не только приложение, но и пользователь уже соединены с БД, и продолжает работу.</p>
<p><A NAME="1039433"></A>
Если соединение не установлено, <CODE>videoapp</CODE> перенаправляет на страницу <CODE>start.htm</CODE>. 
На ней приложение создаёт единый пул соединений с БД, используемый всеми 
потребителями, получает соединение для пользователя и стартует транзакцию с БД 
для этого соединения. Затем перенаправляет обратно на <CODE>home.htm</CODE> для 
продолжения. Пользователь никогда не видит перенаправления.</p>
<p><A NAME="1039468"></A>Транзакция базы данных стартует на странице <CODE>start.htm</CODE>&nbsp; 
и остаётся открытой, пока пользователь явно не сохранит или не отменит изменения,
щёлкнув кнопку Save Changes или Abort Changes. При этом запускается
<CODE>save.htm</CODE> или <CODE>abort.htm</CODE>. Эти страницы подтверждают или 
откатывают изменения открытой транзакции, а затем немедленно начинают новую 
транзакцию. Поэтому соединение потребителя всегда остаётся открытым.</p>
<p><A NAME="1039429"></A>Получив соединение с БД, <CODE>videoapp</CODE> выводит 
пользователю главную страницу. С неё пользователь может сделать выбор - такой 
как аренда клипа или добавление нового потребителя. Каждая из этих опций выводит 
разные страницы, которые содержат операторы серверного
JavaScript. Многие страницы имеют операторы, использующие соединение для 
взаимодействия с БД, выводя информацию или внося изменения в БД.</p>
<p><A NAME="1040863"></A>
Первое, что Вы обязаны сделать при первом соединении, это добавить нового 
потребителя. Пока Вы этого не сделаете,
отсутствуют потребители для выполнения других действий программы.</p>
<H4><A NAME="Head3;"></A><A NAME="1039501"></A>Взятие Клипа Напрокат</H4><hr>
<p><A NAME="1039556"></A>Страница <CODE>pick.htm</CODE> содержит набор фрэймов, 
где пользователь может взять клип напрокат. Набор фрэймов состоит из страниц
<CODE>category.htm</CODE>, <CODE>videos.htm</CODE> и <CODE>pickmenu.htm</CODE>.</p>
<p><A NAME="1039603"></A>Страница <CODE>category.htm</CODE> запрашивает в БД список известных категорий 
клипов. Затем выводит эти категории в виде списка ссылок в таблице левого фрэйма. 
Если пользователь щёлкает на одной из ссылок,
<CODE>videoapp</CODE> выводит <CODE>video.htm</CODE> в правом фрэйме. Есть 
несколько интересных моментов, касающихся серверного кода, выполняющего эти 
задачи. На странице Вы можете найти такие строки:</p>
<PRE><A NAME="1039610"></A>var userId = unscramble(client.userId)<br>
var bucket = project.sharedConnections.connections[userId]<br>var connection = bucket.connection</PRE>
<p><A NAME="1039563"></A>Эти операторы имеются на большинстве страниц <CODE>videoapp</CODE>. 
Они запрашивают соединение из того места, где оно хранится в объекте <CODE>project</CODE>. 
Следующая строка получает новый курсор, применимый для данной задачи:</p>
<PRE><A NAME="1039637"></A>cursor = connection.cursor("select * from categories");</PRE>
<p><A NAME="1039617"></A>Вариант этого оператора имеется в начале большинства задач.</p><p><A NAME="1039641"></A>
Вот следующий интересный набор операторов:</p>
<PRE><A NAME="1039654"></A>&lt;SERVER&gt;<br>...<br>while (cursor.next()) {<br>
&nbsp;&nbsp;&nbsp;catstr = escape(cursor.category)<br>&lt;/SERVER&gt;</PRE>
<PRE><A NAME="1039669"></A>&lt;TR&gt;&lt;TD&gt;&lt;A HREF=`"videos.htm?category=" +
catstr` TARGET="myright"&gt;<br>&lt;SERVER&gt;write(cursor.category);&lt;/SERVER&gt;&lt;/A&gt;<br>
&lt;/TD&gt;<br>&lt;/TR&gt;<br>&lt;SERVER&gt;</PRE><PRE><A NAME="1039668"></A>} // окончание цикла while</PRE>
<p><A NAME="1039670"></A>Этот цикл создаёт в курсоре ссылку для каждой категории. 
Обратите особое внимание на оператор:</p>
<PRE><A NAME="1039674"></A>&lt;A HREF=`"videos.htm?category=" +
catstr` TARGET="myright"&gt;</PRE><p><A NAME="1039679"></A>
Эта строка создаёт ссылку на <CODE>videos.htm</CODE>. Она содержит в URL имя категории.
Предположим, это категория Comedy. Оператор создаёт такую ссылку:</p>
<PRE><A NAME="1039686"></A>&lt;A HREF="videos.htm?category=Comedy" TARGET="myright"&gt;</PRE>
<p><A NAME="1039713"></A>Когда пользователь щёлкает на ссылке, сервер переходит на 
страницу <CODE>videos.htm</CODE> и устанавливает значение свойства <CODE>category </CODE>
объекта <CODE>request</CODE> в <CODE>Comedy</CODE>.</p>
<p><A NAME="1039752"></A>Страница <CODE>videos.htm</CODE> может обрабатываться 
из <CODE>pick.htm</CODE> или из <CODE>category.htm</CODE>. В первом случае 
свойство <CODE>category</CODE> не устанавливается, поэтому страница выводит сообщение, 
предлагающее пользователю выбрать категорию. Если <CODE>category</CODE> 
правильно установлено, <CODE>videos.htm</CODE> входит в БД для вывода информации 
обо всех клипах данной категории. Эта страница использует ту же технику, что и <CODE>category.htm</CODE>, 
для конструирования информации и создания ссылок на странице
<CODE>rent.htm</CODE>.</p>
<p><A NAME="1039753"></A>Страница <CODE>rent.htm</CODE> фактически записывает 
взятые пользователем напрокат клипы. Она получает информацию из запроса и 
обновляет таблицу в БД для отражения новой аренды. Эта страница выполняет 
обновление, но не подтверждает изменения, пока пользователь не 
выберет Save Changes или Abort Changes.</p>
<p><A NAME="1039715"></A>Страница <CODE>pickmenu.htm</CODE> просто выводит кнопки для возврата на 
домашнюю страницу или на страницу для добавления нового потребителя.</p>
<h4><A NAME="Head2;"></A><A NAME="1041417"></A>
Модифицирование videoapp</h4><hr>
<p><A NAME="1041418"></A>Как способ применения функциональности LiveWire
рассмотрим пример модернизации <CODE>videoapp</CODE>. Вот что можно сделать:</p>
<ul><LI><A NAME="1039399"></A>Изменить предположение о том, что существование массива
<CODE>sharedConnections</CODE> предполагает наличие соединения у пользователя. 
Вы можете изменить <CODE>start.htm</CODE>, чтобы выполнять проверку наличия ID у данного 
пользователя в этом массиве и проверить, хранится ли соединение в нужном месте. 
См. раздел <A HREF="db1.htm#1044823">"Совместное Использование Массива Пула Соединений&quot;</A>.</LI>
<LI><A NAME="1042028"></A>Это приложение никогда не возвращает соединения обратно в пул.
Следовательно, если некоторое количество пользователей соединились, больше 
никто соединиться не сможет. Вы можете изменить это двумя путями: добавить 
новую команду, позволяющую пользователю указывать на завершение работы, или 
реализовать схему зачистки неиспользуемых соединений. См. <A HREF="db1.htm#1051342">"Запрашивание 
Свободного Соединения&quot;</A>.</LI></ul>
<h5><a href="contents.htm">Оглавление</a> | <a href="errors.htm">Назад</a>
| <a href="partlc.htm">Вперёд</a>
| <a href="bklast.htm">Индекс</a></h5>
<hr><P ALIGN=right><FONT SIZE=-2><I>Дата последнего обновления: 29 сентября 1999 г.</I></FONT><P><FONT FACE="PrimaSans BT, Verdana, Sans-Serif" SIZE=-2>
&copy; Copyright © 1999 Sun Microsystems, Inc. Некоторая часть Copyright 
© 1999 Netscape Communications Corp. Все Права Зарезервированы.</FONT>
</BODY></HTML>